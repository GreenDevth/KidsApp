<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏µ‡∏ô 3 ‡∏†‡∏≤‡∏©‡∏≤ - Chinese Master</title>
    <meta name="description" content="‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÑ‡∏ó‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á AI">
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Sarabun:wght@300;400;600&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                        body: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            red: '#e74c3c',
                            blue: '#3498db',
                            green: '#2ecc71',
                            dark: '#2c3e50',
                            light: '#f8f9fa'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Mobile Touch Optimizations */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        button, .cursor-pointer {
            touch-action: manipulation;
        }

        /* Dragging mobile styles */
        .dragging-mobile {
            opacity: 0.5;
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        /* Mobile-specific improvements */
        @media (max-width: 768px) {
            /* Base font size increase */
            body {
                font-size: 16px;
            }

            /* Larger touch targets */
            button, input[type="range"], select {
                min-height: 44px;
                min-width: 44px;
                font-size: 16px !important;
            }

            input[type="text"] {
                min-height: 44px;
                font-size: 16px !important;
            }

            /* Card improvements */
            .card-hover {
                padding: 1.25rem !important;
                margin: 0.5rem !important;
            }

            /* Heading sizes */
            h2 {
                font-size: 1.75rem !important;
            }

            h3 {
                font-size: 1.25rem !important;
            }

            /* Hide desktop-only elements */
            .hidden-mobile {
                display: none !important;
            }

            /* Improve table scrolling */
            #mgmt-area {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 14px;
            }

            table td, table th {
                padding: 0.75rem !important;
            }

            /* Stack controls vertically on mobile */
            .control-grid {
                grid-template-columns: 1fr !important;
                gap: 0.75rem !important;
            }

            /* Game area mobile */
            #game-area img {
                max-width: 250px !important;
                margin: 1rem auto !important;
            }

            /* Vocabulary cards - one column on mobile */
            #grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
                padding: 0.5rem !important;
            }

            /* Navigation */
            nav {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            nav button {
                flex: 1 1 calc(50% - 0.25rem);
                min-width: calc(50% - 0.25rem);
            }
        }

        /* Landscape mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            #grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            #game-area img {
                max-width: 180px !important;
            }
        }

        /* Modal mobile optimization */
        @media (max-width: 768px) {
            #add-modal input[type="text"] {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 0.75rem !important;
            }

            #add-modal button {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 0.75rem 1.5rem !important;
            }

            #add-modal .inline-block {
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            #print-area {
                display: block !important;
            }

            body {
                background: white;
            }

            .page-break {
                page-break-after: always;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            th,
            td {
                border: 1px solid black;
                padding: 10px;
                text-align: center;
            }
        }

        #print-area {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans min-h-screen">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass shadow-md no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-brand-red to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        ‰∏≠
                    </div>
                    <div>
                        <h1
                            class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-brand-dark to-brand-blue">
                            Chinese Master
                        </h1>
                        <p class="text-xs text-gray-500 font-body">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå 3 ‡∏†‡∏≤‡∏©‡∏≤ & ‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏†‡∏≤‡∏û</p>
                    </div>
                </div>
                <div class="flex gap-3 items-center">
                    <div class="hidden lg:block text-xs text-gray-500 bg-yellow-50 px-3 py-1.5 rounded-lg border border-yellow-200">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i>
                        <span class="font-bold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ‡∏ö‡∏≤‡∏á AI ‡∏≠‡πà‡∏≤‡∏ô‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡∏ú‡∏¥‡∏î (‡πÄ‡∏ä‡πà‡∏ô Â≠¶Ê†° ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏´‡∏≤‡∏∞‡∏´‡πà‡∏≤‡∏ß" ‡πÅ‡∏ó‡∏ô "‡πÄ‡∏™‡∏ß‡∏µ‡∏¢-‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏ß") 
                        ‚Üí ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>Microsoft Yunxi</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>Xiaoxiao</strong>
                    </div>
                    <button onclick="startGame()"
                        class="hidden md:flex items-center gap-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-2.5 rounded-full font-bold shadow-lg hover:shadow-orange-500/30 transition-all transform hover:scale-105 active:scale-95">
                        <i class="fas fa-gamepad"></i> ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏®‡∏±‡∏û‡∏ó‡πå
                    </button>
                    <!-- Mobile Menu Button (Simplified) -->
                    <button onclick="startGame()"
                        class="md:hidden w-10 h-10 bg-yellow-500 text-white rounded-full shadow-lg">
                        <i class="fas fa-gamepad"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 no-print">

        <!-- Game Area -->
        <div id="game-area"
            class="hidden bg-white rounded-3xl shadow-2xl overflow-hidden mb-10 border-4 border-brand-red/10 relative fade-in">
            <button onclick="stopGame()"
                class="absolute top-4 right-4 w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 transition">
                <i class="fas fa-times"></i>
            </button>

            <div class="p-8 md:p-12 text-center">
                <span class="inline-block px-3 py-1 bg-brand-red/10 text-brand-red rounded-full text-sm font-bold mb-4">
                    üéÆ ‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
                </span>

                <div class="flex justify-center items-center min-h-[300px] mb-6">
                    <!-- Image Question -->
                    <div id="game-question-img" class="hidden transform transition-all hover:scale-105 duration-300">
                        <img id="g-img" src="" alt="Question"
                            class="max-h-[300px] rounded-2xl shadow-xl object-cover border-4 border-white ring-4 ring-gray-100">
                    </div>
                    <!-- Text Question (Fallback) -->
                    <div id="game-question-text" class="hidden">
                        <h1 id="g-zh" class="text-8xl md:text-9xl font-bold text-brand-dark drop-shadow-sm"></h1>
                    </div>
                </div>

                <!-- Multiple Choice Area -->
                <div id="choice-area" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-3xl mx-auto mb-8">
                    <!-- Buttons injected by JS -->
                </div>

                <!-- Feedback Area (Hidden by default) -->
                <div id="game-feedback"
                    class="hidden bg-red-50 border border-red-100 rounded-xl p-4 mb-6 max-w-xl mx-auto animate-pulse">
                    <p id="feedback-text" class="text-lg text-red-600 font-body"></p>
                    <button id="next-q-btn" onclick="nextQuestion()"
                        class="mt-3 bg-brand-dark text-white px-6 py-2 rounded-lg text-sm hover:bg-gray-800 transition">
                        ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                    </button>
                </div>
            </div>
        </div>

        <!-- Controls Dashboard -->
        <div class="bg-white rounded-2xl shadow-sm p-6 mb-8 border border-gray-100">
            <div class="control-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-end">

                <!-- Voice Settings -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider"><i
                            class="fas fa-volume-up mr-1"></i> ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô <span class="text-yellow-500" title="‚ö†Ô∏è ‡∏ö‡∏≤‡∏á AI ‡∏≠‡πà‡∏≤‡∏ô‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡∏•‡∏≠‡∏á Yunxi/Xiaoxiao">‚ö†Ô∏è</span></label>
                    <div class="relative">
                        <select id="voiceCN" onchange="saveSettings()"
                            class="w-full bg-gray-50 border border-gray-200 hover:border-brand-blue rounded-xl px-4 py-2.5 appearance-none focus:outline-none focus:ring-2 focus:ring-brand-blue/20 transition cursor-pointer text-sm"></select>
                        <i
                            class="fas fa-chevron-down absolute right-4 top-3.5 text-gray-400 pointer-events-none text-xs"></i>
                    </div>
                    <p class="text-xs text-gray-400 italic">üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: Microsoft Yunxi (Mainland)</p>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider"><i
                            class="fas fa-volume-up mr-1"></i> ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</label>
                    <div class="relative">
                        <select id="voiceEN" onchange="saveSettings()"
                            class="w-full bg-gray-50 border border-gray-200 hover:border-brand-blue rounded-xl px-4 py-2.5 appearance-none focus:outline-none focus:ring-2 focus:ring-brand-blue/20 transition cursor-pointer text-sm"></select>
                        <i
                            class="fas fa-chevron-down absolute right-4 top-3.5 text-gray-400 pointer-events-none text-xs"></i>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider"><i
                            class="fas fa-volume-up mr-1 text-brand-green"></i> ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (NEW)</label>
                    <div class="relative">
                        <select id="voiceTH" onchange="saveSettings()"
                            class="w-full bg-gray-50 border border-gray-200 hover:border-brand-green rounded-xl px-4 py-2.5 appearance-none focus:outline-none focus:ring-2 focus:ring-brand-green/20 transition cursor-pointer text-sm"></select>
                        <i
                            class="fas fa-chevron-down absolute right-4 top-3.5 text-gray-400 pointer-events-none text-xs"></i>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏á: <span
                            id="rVal" class="text-brand-blue">0.8</span></label>
                    <input type="range" id="rate" min="0.1" max="1.5" step="0.1" value="0.8" onchange="saveSettings()"
                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-dark">
                </div>

            </div>

            <div class="flex flex-wrap gap-3 mt-6 pt-6 border-t border-gray-100">
                <button onclick="document.getElementById('add-modal').classList.remove('hidden')"
                    class="bg-brand-dark text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-800 transition shadow-sm">
                    <i class="fas fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
                </button>
                <button onclick="toggleMgmt()"
                    class="bg-white border border-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm hover:bg-gray-50 transition shadow-sm">
                    <i class="fas fa-table mr-1"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                
                <!-- GitHub Sync Button -->
                <button onclick="loadFromGitHub()"
                    class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:shadow-lg transition shadow-sm font-bold">
                    <i class="fab fa-github mr-1"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å GitHub
                </button>
                
                <div class="flex gap-2">
                    <input type="file" id="csv-input" accept=".csv" class="hidden" onchange="processCSV(this)">
                    <button onclick="triggerImport()"
                        class="bg-white border border-blue-200 text-blue-600 px-4 py-2 rounded-lg text-sm hover:bg-blue-50 transition shadow-sm">
                        <i class="fas fa-file-import mr-1"></i> Import CSV
                    </button>
                    <button onclick="exportCSV()"
                        class="bg-white border border-green-200 text-green-600 px-4 py-2 rounded-lg text-sm hover:bg-green-50 transition shadow-sm">
                        <i class="fas fa-file-csv mr-1"></i> Save CSV
                    </button>
                </div>
                <input type="file" id="json-input" accept=".json" class="hidden" onchange="importData(this)">
                <button onclick="document.getElementById('json-input').click()"
                    class="bg-white border border-purple-200 text-purple-600 px-4 py-2 rounded-lg text-sm hover:bg-purple-50 transition shadow-sm">
                    <i class="fas fa-file-import mr-1"></i> Import JSON
                </button>
                <button onclick="exportData()"
                    class="bg-white border border-indigo-200 text-indigo-600 px-4 py-2 rounded-lg text-sm hover:bg-indigo-50 transition shadow-sm">
                    <i class="fas fa-file-export mr-1"></i> Export JSON
                </button>
                <button onclick="resetDefault()" class="ml-auto text-red-400 hover:text-red-500 text-sm px-4 py-2">
                    <i class="fas fa-trash-alt mr-1"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>

            <!-- Management Table Area -->
            <div id="mgmt-area" class="hidden mt-6 overflow-x-auto rounded-xl border border-gray-200">
                <table class="w-full text-left bg-white">
                    <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                        <tr>
                            <th class="px-3 py-3 text-center w-20">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th class="px-3 py-3">‡∏à‡∏µ‡∏ô</th>
                            <th class="px-3 py-3">‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô</th>
                            <th class="px-3 py-3">‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</th>
                            <th class="px-3 py-3">‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢</th>
                            <th class="px-3 py-3">‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢</th>
                            <th class="px-3 py-3">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û URL</th>
                            <th class="px-3 py-3 text-center w-28">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="mgmt-tbody" class="divide-y divide-gray-100">
                        <!-- Rows -->
                    </tbody>
                </table>
                <div class="p-4 bg-gray-50 flex flex-col md:flex-row items-center justify-between gap-3 border-t border-gray-100 sticky bottom-0">
                    <div class="text-xs text-gray-400 hidden md:block">
                        <i class="fas fa-info-circle mr-1"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        (Auto-Save)
                    </div>
                    <button onclick="manualSave()"
                        class="w-full md:w-auto bg-brand-green text-white px-6 py-3 md:py-2 rounded-lg text-base md:text-sm font-bold shadow-sm hover:bg-green-600 transition active:scale-95">
                        <i class="fas fa-save mr-1"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Search -->
        <div class="relative mb-8">
            <input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå... (‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏ó‡∏¢, ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©, ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏µ‡∏ô)"
                class="w-full bg-white border-0 py-4 pl-12 pr-6 rounded-2xl shadow-md text-lg focus:ring-4 focus:ring-brand-blue/10 transition placeholder-gray-400">
            <i class="fas fa-search absolute left-5 top-5 text-gray-400 text-lg"></i>
        </div>

        <!-- Vocab Grid -->
        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards will be injected here -->
        </div>

    </div>

    <!-- Add Modal -->
    <div id="add-modal" class="hidden fixed inset-0 z-[60] overflow-y-auto" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                onclick="document.getElementById('add-modal').classList.add('hidden')"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div
                class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-2" id="modal-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <p class="text-xs text-gray-500 mb-3"><i class="fas fa-info-circle text-blue-500 mr-1"></i> ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ <span class="text-red-500 font-bold">*</span> (‡∏à‡∏µ‡∏ô, ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©, ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ó‡∏¢)</p>
                    
                    <!-- Auto-Translate Button -->
                    <button type="button" onclick="autoTranslate()" 
                        class="w-full mb-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2.5 rounded-lg text-sm font-bold shadow-md hover:shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2">
                        <i class="fas fa-language"></i> üåê ‡πÅ‡∏õ‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏Å‡∏£‡∏≠‡∏Å 1 ‡∏†‡∏≤‡∏©‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ)
                    </button>

                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-600 mb-1 block">‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô <span class="text-red-500">*</span></label>
                            <input type="text" id="inZh" placeholder="‡πÄ‡∏ä‡πà‡∏ô Áå´"
                                class="w-full border-2 border-orange-200 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô</label>
                            <input type="text" id="inPy" placeholder="‡πÄ‡∏ä‡πà‡∏ô mƒÅo (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"
                                class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-brand-blue/50 focus:border-brand-blue outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-600 mb-1 block">‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© <span class="text-red-500">*</span></label>
                            <input type="text" id="inEn" placeholder="‡πÄ‡∏ä‡πà‡∏ô Cat"
                                class="w-full border-2 border-orange-200 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏Ñ‡∏≥‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢</label>
                            <input type="text" id="inThRead" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"
                                class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-brand-blue/50 focus:border-brand-blue outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-600 mb-1 block">‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢ <span class="text-red-500">*</span></label>
                            <input type="text" id="inTh" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏°‡∏ß"
                                class="w-full border-2 border-orange-200 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 mb-1 block">Emoji/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                            <input type="text" id="inImg" placeholder="‡πÄ‡∏ä‡πà‡∏ô üê± ‡∏´‡∏£‡∏∑‡∏≠ URL (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"
                                class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-brand-blue/50 focus:border-brand-blue outline-none">
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-4 sm:px-6 flex flex-col-reverse sm:flex-row sm:justify-end gap-3">
                    <button onclick="document.getElementById('add-modal').classList.add('hidden')" type="button"
                        class="w-full sm:w-auto inline-flex justify-center rounded-xl border-2 border-gray-300 shadow-sm px-6 py-3 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none active:scale-95 transition">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button onclick="addNew()" type="button"
                        class="w-full sm:w-auto inline-flex justify-center rounded-xl border border-transparent shadow-sm px-6 py-3 bg-brand-green text-base font-bold text-white hover:bg-green-700 focus:outline-none active:scale-95 transition">
                        <i class="fas fa-plus-circle mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Area -->
    <div id="print-area">
        <h1>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô</h1>
        <div id="print-pages"></div>
    </div>

    <script>
        // --- DATA ---
        const defaultData = [
            { zh: "Ê°åÂ≠ê", py: "zhu≈çzi", en: "Table", thRead: "‡∏à‡∏±‡∏ß-‡∏à‡∏∂", th: "‡πÇ‡∏ï‡πä‡∏∞", emoji: "ü™ë" },
            { zh: "Ê§ÖÂ≠ê", py: "y«êzi", en: "Chair", thRead: "‡∏≠‡∏µ‡πà-‡∏à‡∏∂", th: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ", emoji: "üí∫" },
            { zh: "Èó®", py: "m√©n", en: "Door", thRead: "‡πÄ‡∏´‡∏°‡∏¥‡∏ô", th: "‡∏õ‡∏£‡∏∞‡∏ï‡∏π", emoji: "üö™" },
            { zh: "Á™óÊà∑", py: "chuƒÅnghu", en: "Window", thRead: "‡∏ä‡∏ß‡∏á-‡∏´‡∏∏", th: "‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á", emoji: "ü™ü" },
            { zh: "ÊàøÈó¥", py: "f√°ngjiƒÅn", en: "Room", thRead: "‡∏ü‡∏≤‡∏á-‡πÄ‡∏à‡∏µ‡∏¢‡∏ô", th: "‡∏´‡πâ‡∏≠‡∏á", emoji: "üõèÔ∏è" },
            { zh: "ÂéïÊâÄ", py: "c√®su«í", en: "Toilet", thRead: "‡πÄ‡∏ä‡πà‡∏≠-‡∏™‡∏±‡πà‡∏ß", th: "‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", emoji: "üöΩ" },
            { zh: "Â≠¶Ê†°", py: "xu√©xi√†o", en: "School", thRead: "‡πÄ‡∏™‡∏ß‡∏µ‡∏¢-‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏ß", th: "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", emoji: "üè´" },
            { zh: "ÂêåÂ≠¶", py: "t√≥ngxu√©", en: "Classmate", thRead: "‡∏ñ‡∏á-‡πÄ‡∏™‡∏ß‡∏µ‡∏¢", th: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ä‡∏±‡πâ‡∏ô", emoji: "üë•" },
            { zh: "‰Ωú‰∏ö", py: "zu√≤y√®", en: "Homework", thRead: "‡∏à‡∏±‡πâ‡∏ß-‡πÄ‡∏¢‡πà", th: "‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô", emoji: "üìù" },
            { zh: "ËØª", py: "d√∫", en: "Read", thRead: "‡∏ï‡∏π‡πã", th: "‡∏≠‡πà‡∏≤‡∏ô", emoji: "üìñ" },
            { zh: "ÂÜôÂ≠ó", py: "xiƒõz√¨", en: "Write", thRead: "‡πÄ‡∏™‡∏µ‡πà‡∏¢-‡∏à‡∏∑‡πâ‡∏≠", th: "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠", emoji: "‚úèÔ∏è" },
            { zh: "ÁîµËÑë", py: "di√†nn«éo", en: "Computer", thRead: "‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡∏ô-‡πÄ‡∏´‡∏ô‡πà‡∏≤", th: "‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", emoji: "üíª" },
            { zh: "Âõæ‰π¶È¶Ü", py: "t√∫sh≈´gu«én", en: "Library", thRead: "‡∏ñ‡∏π-‡∏ã‡∏π-‡∏Å‡πà‡∏ß‡∏ô", th: "‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î", emoji: "üìö" },
            { zh: "ÊïôÂÆ§", py: "ji√†osh√¨", en: "Classroom", thRead: "‡πÄ‡∏à‡∏µ‡πâ‡∏¢‡∏ß-‡∏ã‡∏∑‡πà‡∏≠", th: "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", emoji: "üéì" },
            { zh: "ÊìçÂú∫", py: "cƒÅoch«éng", en: "Playground", thRead: "‡πÄ‡∏å‡∏≤-‡∏â‡πà‡∏≤‡∏á", th: "‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤", emoji: "‚öΩ" },
            { zh: "È£üÂ†Ç", py: "sh√≠t√°ng", en: "Canteen", thRead: "‡∏™‡∏∑‡∏≠-‡∏ñ‡∏≤‡∏á", th: "‡πÇ‡∏£‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£", emoji: "üçΩÔ∏è" },
            { zh: "‰ºëÊÅØ", py: "xi≈´xi", en: "Rest", thRead: "‡∏ã‡∏¥‡πà‡∏ß-‡∏™‡∏¥", th: "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô", emoji: "üò¥" },
            { zh: "ÂÆ∂", py: "jiƒÅ", en: "Home", thRead: "‡πÄ‡∏à‡∏µ‡∏¢", th: "‡∏ö‡πâ‡∏≤‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß", emoji: "üè†" },
            { zh: "Ê∞¥", py: "shu«ê", en: "Water", thRead: "‡∏™‡∏∏‡πà‡∏¢", th: "‡∏ô‡πâ‡∏≥", emoji: "üíß" },
            { zh: "Á±≥È•≠", py: "m«êf√†n", en: "Steamed Rice", thRead: "‡∏´‡∏°‡∏µ‡πà-‡∏ü‡πà‡∏≤‡∏ô", th: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏ß‡∏¢", emoji: "üçö" },
            { zh: "Èù¢ÂåÖ", py: "mi√†nbƒÅo", en: "Bread", thRead: "‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏ô-‡πÄ‡∏õ‡∏≤", th: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á", emoji: "üçû" },
            { zh: "Ëä±", py: "huƒÅ", en: "Flower", thRead: "‡∏Æ‡∏ß‡∏≤", th: "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", emoji: "üå∏" },
            { zh: "Ê†ë", py: "sh√π", en: "Tree", thRead: "‡∏ã‡∏π", th: "‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ", emoji: "üå≥" },
            { zh: "Èõ®", py: "y«î", en: "Rain", thRead: "‡∏≠‡∏ß‡∏µ‡πà", th: "‡∏ù‡∏ô", emoji: "üåßÔ∏è" },
            { zh: "Â§©Á©∫", py: "tiƒÅnk≈çng", en: "Sky", thRead: "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô-‡∏Ñ‡∏á", th: "‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤", emoji: "‚òÅÔ∏è" },
            { zh: "Â§™Èò≥", py: "t√†iy√°ng", en: "Sun", thRead: "‡πÑ‡∏ó‡πâ-‡∏´‡∏¢‡∏≤‡∏á", th: "‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", emoji: "‚òÄÔ∏è" },
            { zh: "Êúà‰∫Æ", py: "yu√®liang", en: "Moon", thRead: "‡πÄ‡∏¢‡πà‡∏ß-‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á", th: "‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", emoji: "üåô" },
            { zh: "ÊòüÊòü", py: "xƒ´ngxing", en: "Star", thRead: "‡∏ã‡∏¥‡∏á-‡∏ã‡∏¥‡∏á", th: "‡∏î‡∏≤‡∏ß", emoji: "‚≠ê" },
            { zh: "Èí±", py: "qi√°n", en: "Money", thRead: "‡πÄ‡∏â‡∏µ‡∏¢‡∏ô", th: "‡πÄ‡∏á‡∏¥‡∏ô", emoji: "üí∞" },
            { zh: "‰π∞‰∏úË•ø", py: "m«éi d≈çngxi", en: "Shopping", thRead: "‡∏´‡∏°‡∏≤‡∏¢-‡∏ï‡∏á-‡∏™‡∏¥", th: "‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á", emoji: "üõí" }
        ];

        // Migrating old data if exists
        let vocabList = JSON.parse(localStorage.getItem('v11FullData')) || [];
        
        // Force update to use emoji instead of img URLs
        const needsUpdate = vocabList.length === 0 || 
                           vocabList.some(item => item.img && !item.emoji);
        
        if (needsUpdate) {
            vocabList = defaultData;
            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
            console.log('‚úÖ Updated to native Emoji!');
        }

        // Settings Management
        const defaultSettings = {
            voiceCN: '',
            voiceEN: '',
            voiceTH: '',
            rate: 0.8  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
        };

        let settings = JSON.parse(localStorage.getItem('v11Settings')) || { ...defaultSettings };

        function saveSettings() {
            settings.voiceCN = document.getElementById('voiceCN').value;
            settings.voiceEN = document.getElementById('voiceEN').value;
            settings.voiceTH = document.getElementById('voiceTH').value;
            settings.rate = document.getElementById('rate').value;
            localStorage.setItem('v11Settings', JSON.stringify(settings));
            showToast('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        function loadSettings() {
            setTimeout(() => {
                const zhSelect = document.getElementById('voiceCN');
                const enSelect = document.getElementById('voiceEN');
                const thSelect = document.getElementById('voiceTH');
                const rateInput = document.getElementById('rate');

                if (settings.voiceCN && zhSelect) {
                    zhSelect.value = settings.voiceCN;
                }
                if (settings.voiceEN && enSelect) {
                    enSelect.value = settings.voiceEN;
                }
                if (settings.voiceTH && thSelect) {
                    thSelect.value = settings.voiceTH;
                }
                if (settings.rate && rateInput) {
                    rateInput.value = settings.rate;
                    document.getElementById('rVal').innerText = settings.rate;
                }
            }, 500);
        }

        // --- VOICE ---
        function populateVoices() {
            voices = window.speechSynthesis.getVoices();

            const selectBestVoice = (langCode, elemId, preferredNames) => {
                const filtered = voices.filter(v => v.lang.includes(langCode));
                const elem = document.getElementById(elemId);
                
                if (filtered.length === 0) {
                    elem.innerHTML = `<option>‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (${langCode})</option>`;
                    return null;
                }

                // Try to find preferred voice (female/child voice for kids)
                let bestVoice = null;
                for (const prefName of preferredNames) {
                    bestVoice = filtered.find(v => v.name.includes(prefName));
                    if (bestVoice) break;
                }

                // If no preferred found, select first female voice or just first one
                if (!bestVoice) {
                    bestVoice = filtered.find(v => v.name.includes('Female') || v.name.includes('female')) 
                        || filtered[0];
                }

                elem.innerHTML = filtered.map(v => `<option value="${v.name}">${v.name}</option>`).join('');
                
                // Set best voice as default if no setting saved
                if (bestVoice && !settings[elemId]) {
                    elem.value = bestVoice.name;
                    settings[elemId] = bestVoice.name;
                    return bestVoice.name;
                }
                return null;
            };

            // Select best voices for each language (kid-friendly female voices)
            const zhVoice = selectBestVoice('zh', 'voiceCN', [
                'Microsoft Xiaoxiao',      // ‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ - ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Mainland)
                'Microsoft Yunxi',         // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Mainland)
                'Microsoft Yunyang',       // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (Mainland)
                'Microsoft Yunjian',       // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á (Mainland)
                'Microsoft Xiaoyi',        // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á (Mainland)
                'Microsoft HsiaoYu',       // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á (Taiwan Mandarin)
                'Microsoft YunJhe',        // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏≤‡∏¢ (Taiwan)
                'Microsoft HsiaoChen',     // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏≤‡∏¢ (Taiwan)
                'Microsoft Huihui',        // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á Desktop (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                'Microsoft Yaoyao',        // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á Desktop (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                'Xiaoxiao',
                'Yunxi',
                'Female'
            ]);

            const enVoice = selectBestVoice('en', 'voiceEN', [
                'Zira',        // Microsoft Zira (Female, US)
                'Samantha',    // Apple Samantha (Female, US)
                'Google US English Female',
                'Susan',       // Apple Susan (Female, US)
                'Female'
            ]);

            const thVoice = selectBestVoice('th', 'voiceTH', [
                'Premwadee',   // Microsoft Premwadee (Female, Thai)
                'Kanya',       // Apple Kanya (Female, Thai)
                'Google ‡πÑ‡∏ó‡∏¢',
                'Female'
            ]);

            // Save auto-selected voices if any
            if (zhVoice || enVoice || thVoice) {
                localStorage.setItem('v11Settings', JSON.stringify(settings));
            }
            
            // Load saved settings after populating voices
            loadSettings();
        }
        window.speechSynthesis.onvoiceschanged = populateVoices;

        function speak(text, type) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);

            let vName;
            if (type === 'zh') vName = document.getElementById('voiceCN').value;
            else if (type === 'en') vName = document.getElementById('voiceEN').value;
            else if (type === 'th') vName = document.getElementById('voiceTH').value;

            const voice = voices.find(v => v.name === vName);
            if (voice) msg.voice = voice;

            msg.rate = document.getElementById('rate').value;
            msg.lang = type === 'zh' ? 'zh-CN' : (type === 'th' ? 'th-TH' : 'en-US');
            window.speechSynthesis.speak(msg);
        }

        // --- RENDER ---
        function render() {
            const grid = document.getElementById('grid');
            const pPages = document.getElementById('print-pages');
            grid.innerHTML = '';
            pPages.innerHTML = '';

            vocabList.forEach((v, i) => {
                // Card UI - Use emoji if available, fallback to img
                const emojiHTML = v.emoji ? `<div class="h-48 w-full mb-4 rounded-xl bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center text-8xl">${v.emoji}</div>` :
                                 v.img ? `<div class="h-48 w-full overflow-hidden mb-4 rounded-xl bg-gray-50 flex items-center justify-center"><img src="${v.img}" class="max-w-full max-h-full object-contain p-2"></div>` : 
                                 `<div class="h-48 w-full bg-brand-light mb-4 rounded-xl flex items-center justify-center text-4xl text-gray-300"><i class="fas fa-image"></i></div>`;

                grid.innerHTML += `
                    <div class="card-hover bg-white rounded-2xl p-6 shadow-sm border border-gray-100 relative group transition-all duration-300">
                        <button onclick="del(${i})" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash-alt"></i></button>
                        
                        ${emojiHTML}

                        <div class="text-center">
                            <h2 class="text-4xl font-bold text-brand-dark mb-1 cursor-pointer hover:text-brand-red transition" onclick="speak('${v.zh}', 'zh')">${v.zh}</h2>
                            <p class="text-gray-400 italic mb-4 font-sans">${v.py}</p>
                            
                            <div class="space-y-2">
                                <div class="flex items-center justify-between bg-blue-50 px-3 py-2 rounded-lg cursor-pointer hover:bg-blue-100 transition" onclick="speak('${v.en}', 'en')">
                                    <span class="text-brand-blue font-bold text-sm">${v.en}</span>
                                    <i class="fas fa-volume-up text-blue-300 text-xs"></i>
                                </div>
                                <div class="flex items-center justify-between bg-green-50 px-3 py-2 rounded-lg cursor-pointer hover:bg-green-100 transition" onclick="speak('${v.th}', 'th')">
                                    <div class="text-left">
                                        <span class="text-brand-green font-bold text-sm block font-body">${v.th}</span>
                                        <span class="text-gray-400 text-xs block font-body">‡∏≠‡πà‡∏≤‡∏ô: ${v.thRead}</span>
                                    </div>
                                    <i class="fas fa-volume-up text-green-300 text-xs"></i>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="speak('${v.zh}', 'zh')" class="w-full mt-4 bg-brand-red text-white py-2 rounded-xl font-bold shadow-md shadow-red-200 hover:bg-red-600 active:scale-95 transition">
                            <i class="fas fa-play mr-2"></i> ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏µ‡∏ô
                        </button>
                    </div>
                `;
            });

            // Print UI
            for (let i = 0; i < vocabList.length; i += 10) {
                const chunk = vocabList.slice(i, i + 10);
                pPages.innerHTML += `
                    <div class="page-break">
                        <h3 class="text-right text-gray-500 mb-2">‡∏´‡∏ô‡πâ‡∏≤ ${Math.floor(i / 10) + 1}</h3>
                        <table>
                            <thead><tr><th>‡∏à‡∏µ‡∏ô</th><th>‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô</th><th>‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</th><th>‡πÑ‡∏ó‡∏¢</th><th>‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</th></tr></thead>
                            <tbody>
                                ${chunk.map(v => `<tr><td>${v.zh}</td><td>${v.py}</td><td>${v.en}</td><td>${v.thRead}</td><td>${v.th}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
        }

        // --- GAME LOGIC (MULTIPLE CHOICE) ---
        let gameChoices = [];
        let isAnswered = false;

        function startGame() {
            document.getElementById('game-area').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            nextQuestion();
        }

        function stopGame() {
            document.getElementById('game-area').classList.add('hidden');
        }

        function nextQuestion() {
            isAnswered = false;
            // 1. Random Target
            currentWord = vocabList[Math.floor(Math.random() * vocabList.length)];

            // 2. Random Distractors
            let distractors = vocabList.filter(v => v !== currentWord);
            // Shuffle distractors
            distractors.sort(() => 0.5 - Math.random());
            // Take 3
            let choices = distractors.slice(0, 3);
            choices.push(currentWord);
            // Shuffle Choices
            choices.sort(() => 0.5 - Math.random());
            gameChoices = choices;

            // 3. Render Question
            const qImg = document.getElementById('game-question-img');
            const qText = document.getElementById('game-question-text');
            const imgEl = document.getElementById('g-img');
            const zhEl = document.getElementById('g-zh');

            if (currentWord.img) {
                imgEl.src = currentWord.img;
                qImg.classList.remove('hidden');
                qText.classList.add('hidden');
            } else {
                zhEl.innerText = currentWord.zh;
                qImg.classList.add('hidden');
                qText.classList.remove('hidden');
            }

            // 4. Render Choices UI
            const choiceArea = document.getElementById('choice-area');
            const feedbackArea = document.getElementById('game-feedback');

            feedbackArea.classList.add('hidden');
            choiceArea.innerHTML = '';

            choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = `w-full bg-white border-2 border-gray-100 p-4 rounded-xl shadow-sm hover:border-brand-blue hover:bg-blue-50 transition text-lg font-bold text-gray-700 active:scale-95 flex items-center justify-center gap-3`;
                // Choice Display: EN + Pinyin or TH? Let's use English + Thai for better understanding
                btn.innerHTML = `<span class="text-brand-dark">${choice.zh}</span> <span class="text-gray-400 text-sm font-normal">(${choice.py})</span>`;

                // If question is text (ZH), choices should probably be meanings (EN/TH)
                // If question is Image, choices can be ZH
                // Let's standardise: Choices show ZH + Pinyin + Main Meaning to help learn connection

                // Let's refine: 
                // IF Question is Image -> Choices are Chinese Words
                // IF Question is Chinese Word -> Choices are English/Thai Meanings

                if (!currentWord.img) {
                    // Question is Text(ZH), Choices = EN
                    btn.innerHTML = `<span class="text-brand-blue">${choice.en}</span> <span class="text-gray-400 text-sm font-body">(${choice.th})</span>`;
                } else {
                    // Question is Image, Choices = ZH
                    btn.innerHTML = `<span class="text-brand-red text-xl">${choice.zh}</span> <span class="text-gray-400 text-sm">(${choice.py})</span>`;
                }

                btn.onclick = () => checkAnswer(choice, btn);
                choiceArea.appendChild(btn);
            });
        }

        function checkAnswer(selected, btnCtx) {
            if (isAnswered) return;
            isAnswered = true;

            const isCorrect = selected === currentWord;
            const feedbackArea = document.getElementById('game-feedback');
            const feedbackText = document.getElementById('feedback-text');
            const nextBtn = document.getElementById('next-q-btn');

            // Highlight Logic
            const buttons = document.getElementById('choice-area').children;
            for (let btn of buttons) {
                btn.disabled = true; // Lock all buttons
                if (gameChoices.find((c, i) => btn === buttons[i]) === currentWord) {
                    // This button is the correct answer
                    btn.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    btn.classList.remove('bg-white', 'border-gray-100');
                    btn.innerHTML += ` <i class="fas fa-check-circle text-green-500"></i>`;
                }
            }

            if (isCorrect) {
                btnCtx.classList.add('ring-4', 'ring-green-200');
                speak('Correct', 'en'); // Sound effect placeholder
                setTimeout(() => speak(currentWord.zh, 'zh'), 500);

                // Auto next after 2s
                setTimeout(nextQuestion, 2000);
            } else {
                btnCtx.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                btnCtx.classList.remove('bg-white', 'border-gray-100');
                btnCtx.innerHTML += ` <i class="fas fa-times-circle text-red-500"></i>`;

                speak('Sorry', 'en');

                // Show manual next button
                feedbackArea.classList.remove('hidden');
                feedbackText.innerHTML = `‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠: <span class="font-bold text-brand-red">${currentWord.zh}</span> ${currentWord.en} (${currentWord.th})`;
                speak(currentWord.zh, 'zh');
            }
        }

        // --- CORE FUNCTIONS ---
        function speak(text, type) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);

            let vName;
            if (type === 'zh') vName = document.getElementById('voiceCN').value;
            else if (type === 'en') vName = document.getElementById('voiceEN').value;
            else if (type === 'th') vName = document.getElementById('voiceTH').value;

            // If voice not found or default, browser chooses
            if (vName && vName !== "") {
                const voice = voices.find(v => v.name === vName);
                if (voice) msg.voice = voice;
            }

            msg.rate = document.getElementById('rate').value;
            msg.lang = type === 'zh' ? 'zh-CN' : (type === 'th' ? 'th-TH' : 'en-US');
            window.speechSynthesis.speak(msg);
        }
        // --- DATA MGMT & CSV ---
        function toggleMgmt() {
            const mgmtArea = document.getElementById('mgmt-area');
            const gridArea = document.getElementById('grid');
            if (mgmtArea.classList.contains('hidden')) {
                mgmtArea.classList.remove('hidden');
                gridArea.classList.add('hidden');
                renderTable();
            } else {
                mgmtArea.classList.add('hidden');
                gridArea.classList.remove('hidden');
                render();
            }
        }

        function renderTable() {
            const tbody = document.getElementById('mgmt-tbody');
            tbody.innerHTML = '';
            vocabList.forEach((v, i) => {
                tbody.innerHTML += `
                    <tr draggable="true" 
                        ondragstart="dragStart(event, ${i})" 
                        ondragover="dragOver(event)" 
                        ondrop="drop(event, ${i})" 
                        ondragend="dragEnd(event)"
                        class="hover:bg-gray-50 border-b border-gray-100 transition cursor-move">
                        <td class="p-3 text-center">
                            <div class="flex flex-col gap-1 items-center">
                                <i class="fas fa-grip-vertical text-gray-300 text-sm" title="‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö"></i>
                                <span class="text-xs font-bold text-gray-400">#${i + 1}</span>
                            </div>
                        </td>
                        <td class="p-3"><input type="text" value="${v.zh}" onchange="updateVal(${i}, 'zh', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none transition"></td>
                        <td class="p-3"><input type="text" value="${v.py}" onchange="updateVal(${i}, 'py', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none text-gray-500 transition"></td>
                        <td class="p-3"><input type="text" value="${v.en}" onchange="updateVal(${i}, 'en', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none text-brand-blue font-bold transition"></td>
                        <td class="p-3"><input type="text" value="${v.th}" onchange="updateVal(${i}, 'th', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none text-brand-green font-bold transition"></td>
                        <td class="p-3"><input type="text" value="${v.thRead}" onchange="updateVal(${i}, 'thRead', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-sm focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none text-xs transition"></td>
                        <td class="p-3"><input type="text" value="${v.img || ''}" placeholder="URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" onchange="updateVal(${i}, 'img', this.value)" class="w-full border border-gray-200 rounded px-2 py-1 text-xs focus:border-brand-blue focus:ring-1 focus:ring-brand-blue outline-none text-gray-400 transition"></td>
                        <td class="p-3 text-center">
                            <button onclick="del(${i})" class="text-red-400 hover:text-red-600 transition p-2 rounded hover:bg-red-50" title="‡∏•‡∏ö">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Drag & Drop functions (with mobile touch support)
        let draggedIndex = null;
        let touchStartY = 0;
        let touchCurrentY = 0;

        function dragStart(event, index) {
            draggedIndex = index;
            event.target.style.opacity = '0.4';
            
            // Add touch event listeners for mobile
            if (event.type === 'touchstart') {
                touchStartY = event.touches[0].clientY;
                event.target.classList.add('dragging-mobile');
            }
        }

        function dragOver(event) {
            event.preventDefault();
            event.currentTarget.style.borderTop = '3px solid #3b82f6';
        }

        function drop(event, dropIndex) {
            event.preventDefault();
            event.currentTarget.style.borderTop = '';
            
            if (draggedIndex === null || draggedIndex === dropIndex) return;
            
            // Reorder array
            const draggedItem = vocabList[draggedIndex];
            vocabList.splice(draggedIndex, 1);
            vocabList.splice(dropIndex, 0, draggedItem);
            
            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
            renderTable();
            render();
            showToast('‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        function dragEnd(event) {
            event.target.style.opacity = '1';
            document.querySelectorAll('#mgmt-tbody tr').forEach(row => {
                row.style.borderTop = '';
            });
            draggedIndex = null;
        }

        function updateVal(index, key, value) {
            vocabList[index][key] = value;
            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function manualSave() {
            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        function showToast(message, type = 'info') {
            // Remove existing toast
            const existing = document.getElementById('toast-notification');
            if (existing) existing.remove();

            // Create new toast
            const toast = document.createElement('div');
            toast.id = 'toast-notification';
            toast.className = `fixed bottom-5 left-1/2 -translate-x-1/2 md:left-auto md:right-5 md:translate-x-0 z-[70] px-6 py-3 rounded-xl shadow-lg transform transition-all duration-300 translate-y-10 opacity-0 flex items-center gap-3 font-body ${type === 'success' ? 'bg-green-600' : 'bg-brand-dark'} text-white max-w-[90vw] md:max-w-none`;
            toast.innerHTML = `<i class="fas fa-check-circle"></i> <span class="text-sm md:text-base">${message}</span>`;
            document.body.appendChild(toast);

            // Animate In
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            });

            // Auto Hide
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Load vocabulary from GitHub repository
        async function loadFromGitHub() {
            const csvUrl = 'https://greendevth.github.io/KidsApp/data/vocabulary.csv';
            
            showToast('üì• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GitHub...', 'info');

            try {
                const response = await fetch(csvUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                const lines = text.split('\n');
                let count = 0;
                let newVocab = [];

                // Skip header (first line)
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Parse CSV (handle quotes)
                    const parts = line.match(/(?:"([^"]*)"|([^,]+))(?:,|$)/g);
                    
                    if (parts && parts.length >= 5) {
                        const cleanParts = parts.map(p => p.replace(/^[",]|[",]$/g, '').trim());
                        
                        newVocab.push({
                            zh: cleanParts[0] || '',
                            py: cleanParts[1] || '',
                            en: cleanParts[2] || '',
                            thRead: cleanParts[3] || '',
                            th: cleanParts[4] || '',
                            emoji: cleanParts[5] || 'üìù',
                            img: cleanParts[5] || ''  // emoji as fallback
                        });
                        count++;
                    }
                }

                if (count > 0) {
                    // Ask user: Replace or Merge?
                    const action = confirm(
                        `‡∏û‡∏ö ${count} ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏≤‡∏Å GitHub\n\n` +
                        `‡∏Å‡∏î OK = ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ (‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°)\n` +
                        `‡∏Å‡∏î Cancel = ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°)`
                    );

                    if (action) {
                        // Merge: Add new vocab to existing
                        vocabList = [...vocabList, ...newVocab];
                        showToast(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° ${count} ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                    } else {
                        // Replace: Overwrite all
                        vocabList = newVocab;
                        showToast(`‚úÖ ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ ${count} ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏à‡∏≤‡∏Å GitHub!`, 'success');
                    }

                    localStorage.setItem('v11FullData', JSON.stringify(vocabList));
                    render();
                    
                    if (!document.getElementById('mgmt-area').classList.contains('hidden')) {
                        renderTable();
                    }
                } else {
                    showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV', 'info');
                }
            } catch (error) {
                console.error('GitHub CSV load error:', error);
                showToast('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å GitHub ‡πÑ‡∏î‡πâ', 'info');
            }
        }

        function triggerImport() {
            document.getElementById('csv-input').click();
        }

        function processCSV(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const text = e.target.result;
                const lines = text.split('\n');
                let count = 0;

                // Skip header if present (Simple check: if first line contains "Chinese")
                const startIndex = lines[0].toLowerCase().includes('chinese') ? 1 : 0;

                for (let i = startIndex; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Simple CSV split (Note: doesn't handle commas inside quotes)
                    const parts = line.split(',');
                    if (parts.length >= 5) { // Ensure min requirements
                        vocabList.push({
                            zh: parts[0]?.trim(),
                            py: parts[1]?.trim(),
                            en: parts[2]?.trim(),
                            thRead: parts[3]?.trim(),
                            th: parts[4]?.trim(),
                            img: parts[5]?.trim() || ""
                        });
                        count++;
                    }
                }

                if (count > 0) {
                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                    render();
                    if (!document.getElementById('mgmt-area').classList.contains('hidden')) renderTable();
                } else {
                    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV');
                }
                // Reset input
                input.value = '';
            };
            reader.readAsText(file);
        }

        function exportCSV() {
            let csvContent = "data:text/csv;charset=utf-8,Chinese,Pinyin,English,ThaiReading,ThaiMeaning,ImageURL\n";
            vocabList.forEach(v => {
                const row = [v.zh, v.py, v.en, v.thRead, v.th, v.img || ''].map(item => `"${item}"`).join(","); // Quote to handle commas
                csvContent += row + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "chinese_vocab_export.csv");
            document.body.appendChild(link);
            link.click();
            link.remove();
        }

        // Helper: Generate Pinyin from Chinese using a simple romanization approach
        async function getPinyin(chineseText) {
            try {
                // Use Google Translate TTS endpoint to get romanization (hacky but works)
                // Alternative: Use a dedicated Pinyin API
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=en&dt=rm&q=${encodeURIComponent(chineseText)}`);
                const data = await response.json();
                
                if (data && data[0] && data[0][0] && data[0][0][3]) {
                    return data[0][0][3]; // Romanization field
                }
                
                // Fallback: try pinyin-lite approach
                return ''; // Return empty if failed
            } catch (error) {
                console.error('Pinyin generation failed:', error);
                return '';
            }
        }

        // Helper: Generate Thai reading from English pronunciation
        function getThaiReading(englishText, chineseText = '') {
            // Simple phonetic mapping (English -> Thai approximation)
            const phoneticMap = {
                'cat': '‡πÅ‡∏Ñ‡∏ó', 'dog': '‡∏î‡πá‡∏≠‡∏Å', 'bird': '‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏î', 'fish': '‡∏ü‡∏¥‡∏ä',
                'door': '‡∏î‡∏≠‡∏£‡πå', 'school': '‡∏™‡∏Å‡∏π‡∏•', 'book': '‡∏ö‡∏∏‡πä‡∏Å', 'pen': '‡πÄ‡∏û‡∏ô',
                'water': '‡∏ß‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå', 'food': '‡∏ü‡∏π‡πâ‡∏î', 'house': '‡πÄ‡∏Æ‡∏≤‡∏™‡πå', 'car': '‡∏Ñ‡∏≤‡∏£‡πå',
                'tree': '‡∏ó‡∏£‡∏µ', 'flower': '‡∏ü‡∏•‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå', 'sun': '‡∏ã‡∏±‡∏ô', 'moon': '‡∏°‡∏π‡∏ô',
                'table': '‡πÄ‡∏ó‡πÄ‡∏ö‡∏¥‡∏•', 'chair': '‡πÅ‡∏ä‡∏£‡πå', 'bed': '‡πÄ‡∏ö‡∏î', 'window': '‡∏ß‡∏¥‡∏ô‡πÇ‡∏î‡∏ß‡πå'
            };
            
            const lower = englishText.toLowerCase();
            if (phoneticMap[lower]) {
                return phoneticMap[lower];
            }
            
            // If no match, return empty (user should fill manually)
            return '';
        }

        // Auto-Translate Function
        async function autoTranslate() {
            const zh = document.getElementById('inZh').value.trim();
            const en = document.getElementById('inEn').value.trim();
            const th = document.getElementById('inTh').value.trim();

            if (!zh && !en && !th) {
                showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏†‡∏≤‡∏©‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'info');
                return;
            }

            showToast('üåê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•...', 'info');

            try {
                // Determine source language and text
                let sourceText = '';
                let sourceLang = '';
                let targetLangs = [];

                if (zh) {
                    sourceText = zh;
                    sourceLang = 'zh-CN';
                    if (!en) targetLangs.push('en');
                    if (!th) targetLangs.push('th');
                } else if (en) {
                    sourceText = en;
                    sourceLang = 'en';
                    if (!zh) targetLangs.push('zh-CN');
                    if (!th) targetLangs.push('th');
                } else if (th) {
                    sourceText = th;
                    sourceLang = 'th';
                    if (!zh) targetLangs.push('zh-CN');
                    if (!en) targetLangs.push('en');
                }

                // Translate to each target language
                for (const targetLang of targetLangs) {
                    // MyMemory API uses 'zh' not 'zh-CN' for target
                    const apiTargetLang = targetLang === 'zh-CN' ? 'zh' : targetLang;
                    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(sourceText)}&langpair=${sourceLang}|${apiTargetLang}`;
                    
                    console.log('Translating:', sourceText, 'from', sourceLang, 'to', apiTargetLang);
                    
                    const response = await fetch(url);
                    const data = await response.json();

                    console.log('Translation response:', data);

                    if (data.responseData && data.responseData.translatedText) {
                        const translated = data.responseData.translatedText;

                        if (targetLang === 'zh-CN') {
                            document.getElementById('inZh').value = translated;
                        } else if (targetLang === 'en') {
                            document.getElementById('inEn').value = translated;
                        } else if (targetLang === 'th') {
                            document.getElementById('inTh').value = translated;
                        }
                    } else {
                        console.error('Translation failed for', targetLang, data);
                    }
                    
                    // Add small delay between requests to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 300));
                }

                // Generate Pinyin if Chinese text exists
                const finalZh = document.getElementById('inZh').value.trim();
                if (finalZh && !document.getElementById('inPy').value.trim()) {
                    const pinyin = await getPinyin(finalZh);
                    if (pinyin) {
                        document.getElementById('inPy').value = pinyin;
                    }
                }

                // Generate Thai reading if English text exists
                const finalEn = document.getElementById('inEn').value.trim();
                if (finalEn && !document.getElementById('inThRead').value.trim()) {
                    const thaiReading = getThaiReading(finalEn, finalZh);
                    if (thaiReading) {
                        document.getElementById('inThRead').value = thaiReading;
                    }
                }

                showToast('‚úÖ ‡πÅ‡∏õ‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö)', 'success');
            } catch (error) {
                console.error('Translation error:', error);
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•', 'info');
            }
        }

        function addNew() {
            const zh = document.getElementById('inZh').value.trim();
            const py = document.getElementById('inPy').value.trim();
            const en = document.getElementById('inEn').value.trim();
            const thRead = document.getElementById('inThRead').value.trim();
            const th = document.getElementById('inTh').value.trim();
            const imgInput = document.getElementById('inImg').value.trim();

            // Validation - require at least one main field (Chinese OR English OR Thai)
            if (!zh && !en && !th) {
                showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏†‡∏≤‡∏©‡∏≤ (‡∏à‡∏µ‡∏ô/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©/‡πÑ‡∏ó‡∏¢)', 'info');
                return;
            }

            // Create vocabulary object with empty strings for missing fields
            const v = {
                zh: zh || '',
                py: py || '',
                en: en || '',
                thRead: thRead || '',
                th: th || '',
                emoji: imgInput || 'üìù',  // Use emoji instead of img
                img: imgInput || ''       // Keep img for backward compatibility
            };

            vocabList.push(v);
            
            // Save to localStorage
            localStorage.setItem('v11FullData', JSON.stringify(vocabList));
            
            // Update UI
            render();
            if (!document.getElementById('mgmt-area').classList.contains('hidden')) {
                renderTable();
            }
            
            // Close modal
            document.getElementById('add-modal').classList.add('hidden');
            
            // Clear inputs
            ['inZh', 'inPy', 'inEn', 'inThRead', 'inTh', 'inImg'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // Show success message
            showToast('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function del(i) {
            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ?')) {
                vocabList.splice(i, 1);
                render();
                if (!document.getElementById('mgmt-area').classList.contains('hidden')) renderTable();
            }
        }

        function resetDefault() {
            if (confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?')) {
                vocabList = [...defaultData];
                render();
                location.reload();
            }
        }

        function exportData() {
            const exportObj = {
                vocabList: vocabList,
                settings: settings,
                exportDate: new Date().toISOString(),
                version: '11'
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj, null, 2));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", `chinese_vocab_backup_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(node);
            node.click();
            node.remove();
            showToast('üì¶ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Check if it's new format (with settings)
                    if (data.vocabList && data.settings) {
                        vocabList = data.vocabList;
                        settings = data.settings;
                        localStorage.setItem('v11FullData', JSON.stringify(vocabList));
                        localStorage.setItem('v11Settings', JSON.stringify(settings));
                        showToast('‚úÖ Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        loadSettings();
                    } else if (Array.isArray(data)) {
                        // Old format (just array)
                        vocabList = data;
                        localStorage.setItem('v11FullData', JSON.stringify(vocabList));
                        showToast('‚úÖ Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    } else {
                        throw new Error('Invalid format');
                    }
                    
                    render();
                    renderTable();
                } catch (err) {
                    showToast('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        document.getElementById('rate').oninput = (e) => {
            document.getElementById('rVal').innerText = e.target.value;
        };

        document.getElementById('search').oninput = (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#grid > div').forEach(card => {
                const text = card.innerText.toLowerCase();
                if (text.includes(term)) card.classList.remove('hidden');
                else card.classList.add('hidden');
            });
        };

        // Init
        populateVoices();
        render();
    </script>
</body>

</html>